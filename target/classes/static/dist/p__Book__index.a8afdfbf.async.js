"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[224],{33934:function(de,V,r){var F=r(55443),v=r(38334),B=r(76299),a=r(75271),D=r(45340),y=r(84701),W=r(52676),l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],C=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],J=function(S,M){var Y=S.fieldProps,R=S.children,Z=S.params,x=S.proFieldProps,H=S.mode,O=S.valueEnum,X=S.request,L=S.showSearch,T=S.options,w=(0,v.Z)(S,l),A=(0,a.useContext)(D.Z);return(0,W.jsx)(y.Z,(0,F.Z)((0,F.Z)({valueEnum:(0,B.h)(O),request:X,params:Z,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,F.Z)({options:T,mode:H,showSearch:L,getPopupContainer:A.getPopupContainer},Y),ref:M,proFieldProps:x},w),{},{children:R}))},$=a.forwardRef(function(b,S){var M=b.fieldProps,Y=b.children,R=b.params,Z=b.proFieldProps,x=b.mode,H=b.valueEnum,O=b.request,X=b.options,L=(0,v.Z)(b,C),T=(0,F.Z)({options:X,mode:x||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},M),w=(0,a.useContext)(D.Z);return(0,W.jsx)(y.Z,(0,F.Z)((0,F.Z)({valueEnum:(0,B.h)(H),request:O,params:R,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,F.Z)({getPopupContainer:w.getPopupContainer},T),ref:S,proFieldProps:Z},L),{},{children:Y}))}),K=a.forwardRef(J),I=$,Q=K;Q.SearchSelect=I,Q.displayName="ProFormComponent",V.Z=Q},48803:function(de,V,r){var F=r(26118),v=r(28992);V.Z=function(B){var a=B.children,D=B.canSeeRole,y=(0,F.useModel)("@@initialState"),W=y.initialState,l=(0,v.Z)(W),C=l.canSeeAdmin,J=l.canSeeReader;return D==="Admin"?C?a:null:D==="Reader"?J?a:null:D===void 0&&(C||J)?a:null}},12542:function(de,V,r){var F=r(48305),v=r.n(F),B=r(75271),a=r(48049),D=r(3403),y=r(30915),W=r(72787),l=r(52676),C=function($){var K=$.onChange,I=$.initialValue,Q=(0,B.useState)(!1),b=v()(Q,2),S=b[0],M=b[1],Y=(0,B.useState)((I==null?void 0:I.filePath)||""),R=v()(Y,2),Z=R[0],x=R[1];(0,B.useEffect)(function(){I&&x(I.filePath)},[I]);var H=function(T){var w=T.type.startsWith("image/");w||a.ZP.error("\u53EA\u80FD\u4E0A\u4F20\u56FE\u7247\u6587\u4EF6!");var A=T.size/1024/1024<2;return A||a.ZP.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC72MB!"),w&&A},O=function(T){if(T.file.status==="uploading"){M(!0);return}if(T.file.status==="done"){var w=T.file.response,A=w.code,ne=w.data;A===2e4&&(x(ne),K==null||K(ne)),M(!1)}else T.file.status==="error"&&(a.ZP.error("".concat(T.file.name," \u4E0A\u4F20\u5931\u8D25")),M(!1))},X=(0,l.jsxs)("div",{children:[S?(0,l.jsx)(y.Z,{}):(0,l.jsx)(W.Z,{}),(0,l.jsx)("div",{style:{marginTop:8},children:"\u4E0A\u4F20"})]});return(0,l.jsxs)("div",{children:[(0,l.jsx)(D.Z,{name:"file",listType:"picture-card",className:"file-uploader",showUploadList:!1,action:"/upload/image",beforeUpload:H,onChange:O,children:Z?(0,l.jsx)("img",{src:"/"+Z,alt:"avatar",style:{width:"100%"}}):X}),Z&&(0,l.jsx)("div",{style:{marginTop:8},children:(0,l.jsxs)("div",{children:["\u8BBF\u95EE\u8DEF\u5F84: ",Z]})})]})};V.Z=C},87909:function(de,V,r){r.r(V),r.d(V,{default:function(){return We}});var F=r(48305),v=r.n(F),B=r(90228),a=r.n(B),D=r(26068),y=r.n(D),W=r(87999),l=r.n(W),C=r(26118);function J(c,e){return $.apply(this,arguments)}function $(){return $=l()(a()().mark(function c(e,i){return a()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,C.request)("/book/getList",y()({method:"GET",params:y()({},e)},i||{})));case 1:case"end":return n.stop()}},c)})),$.apply(this,arguments)}function K(c){return I.apply(this,arguments)}function I(){return I=l()(a()().mark(function c(e){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/bookType/getAll",y()({method:"GET",params:{}},e||{})));case 1:case"end":return t.stop()}},c)})),I.apply(this,arguments)}function Q(c,e){return b.apply(this,arguments)}function b(){return b=l()(a()().mark(function c(e,i){return a()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,C.request)("/book/add",y()({method:"POST",headers:{"Content-Type":"application/json"},data:e},i||{})));case 1:case"end":return n.stop()}},c)})),b.apply(this,arguments)}function S(c,e){return M.apply(this,arguments)}function M(){return M=l()(a()().mark(function c(e,i){return a()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,C.request)("/book/readBook",y()({method:"POST",headers:{"Content-Type":"application/json"},data:e},i||{})));case 1:case"end":return n.stop()}},c)})),M.apply(this,arguments)}function Y(c,e,i){return R.apply(this,arguments)}function R(){return R=l()(a()().mark(function c(e,i,t){var n;return a()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=e.id,d.abrupt("return",(0,C.request)("/book/update/".concat(n),y()({method:"PUT",headers:{"Content-Type":"application/json"},params:y()({},e),data:i},t||{})));case 2:case"end":return d.stop()}},c)})),R.apply(this,arguments)}function Z(c,e){return x.apply(this,arguments)}function x(){return x=l()(a()().mark(function c(e,i){var t;return a()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return t=e.ids,h.abrupt("return",(0,C.request)("/book/delete/".concat(t),y()({method:"DELETE",params:y()({},e)},i||{})));case 2:case"end":return h.stop()}},c)})),x.apply(this,arguments)}var H=r(28992),O=r(48803),X=r(99505),L=r(93378),T=r(22421),w=r(7389),A=r(48049),ne=r(73694),Be=r(34830),E=r(75271),ge=r(86073),o=r(52676),Me=function(e){var i=e.modalVisible,t=e.onCancel,n=e.title,h=n||"\u65B0\u589E";return(0,o.jsx)(ge.Z,{destroyOnClose:!0,title:h,width:420,open:i,onCancel:function(){return t()},footer:null,children:e.children})},ye=Me,we=r(79558),be=r(51560),ue=r(42410),Ee=r(33934),Ae=r(56346),De=r(12542),Xe=function(e,i){for(var t=[],n=e;n<i;n++)t.push(n);return t},Re=function(e){var i=we.A.useForm(),t=v()(i,1),n=t[0],h=(0,E.useState)([]),d=v()(h,2),u=d[0],g=d[1],N=function(){var z=l()(a()().mark(function j(){var ee;return a()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,K();case 2:ee=G.sent,g(ee.data);case 4:case"end":return G.stop()}},j)}));return function(){return z.apply(this,arguments)}}();(0,E.useEffect)(function(){N()},[]);var se=(0,E.useState)([]),oe=v()(se,2),q=oe[0],ce=oe[1];return(0,E.useEffect)(function(){if(u&&Array.isArray(u)&&u.length>0){var z=u.map(function(j){return{label:j.typeName,value:j.id}});ce(z)}},[u]),(0,E.useEffect)(function(){console.log(q,"typevalueEnum")},[q]),(0,o.jsx)(be.L0,{stepsProps:{size:"small"},stepsFormRender:function(j,ee){return(0,o.jsx)(ge.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:"\u4FEE\u6539",open:e.updateModalVisible,footer:ee,onCancel:function(){return e.onCancel()},children:j})},onFinish:e.onSubmit,children:(0,o.jsxs)(be.L0.StepForm,{initialValues:{bookName:e.values.bookName,bookAuthor:e.values.bookAuthor,bookPrice:e.values.bookPrice,bookTypeId:e.values.bookTypeId,bookDesc:e.values.bookDesc,isBorrowed:e.values.isBorrowed,bookImg:e.values.bookImg},title:"\u4FEE\u6539\u56FE\u4E66\u4FE1\u606F",children:[(0,o.jsx)(ue.Z,{width:"md",name:"bookName",label:"\u56FE\u4E66\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}]}),(0,o.jsx)(ue.Z,{width:"md",name:"bookAuthor",label:"\u4F5C\u8005",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}]}),(0,o.jsx)(ue.Z,{width:"md",name:"bookPrice",label:"\u4EF7\u683C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}]}),(0,o.jsx)(Ee.Z,{name:"bookTypeId",label:"\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9!"}],options:q}),(0,o.jsx)(ue.Z,{width:"md",name:"bookDesc",label:"\u63CF\u8FF0"}),(0,o.jsx)(Ee.Z,{name:"isBorrowed",label:"\u662F\u5426\u88AB\u501F\u9605",rules:[{required:!0,message:"\u8BF7\u9009\u62E9!"}],options:[{label:"\u662F",value:!0},{label:"\u5426",value:!1}]}),(0,o.jsx)(Ae.Z.Item,{label:"\u56FE\u7247",name:"bookImg",children:(0,o.jsx)(De.Z,{initialValue:{filePath:e.values.bookImg},onChange:function(j){n.setFieldValue("bookImg",j==null?void 0:j.filePath)}})})]})})},Ze=Re,xe=function(){var c=l()(a()().mark(function e(i){var t,n;return a()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return t=A.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),d.prev=1,d.next=4,Q(y()({},i));case 4:if(n=d.sent,t(),n.code!==2e4){d.next=10;break}return d.abrupt("return",!0);case 10:return d.abrupt("return",!1);case 11:d.next=17;break;case 13:return d.prev=13,d.t0=d.catch(1),t(),d.abrupt("return",!1);case 17:case"end":return d.stop()}},e,null,[[1,13]])}));return function(i){return c.apply(this,arguments)}}(),Oe=function(){var c=l()(a()().mark(function e(i,t){var n,h;return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=A.ZP.loading(""),u.prev=1,u.next=4,S({bookId:i,returnTime:t});case 4:if(h=u.sent,n(),h.code!==2e4){u.next=10;break}return u.abrupt("return",!0);case 10:return u.abrupt("return",!1);case 11:u.next=17;break;case 13:return u.prev=13,u.t0=u.catch(1),n(),u.abrupt("return",!1);case 17:case"end":return u.stop()}},e,null,[[1,13]])}));return function(i,t){return c.apply(this,arguments)}}(),Le=function(){var c=l()(a()().mark(function e(i,t){var n,h;return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=A.ZP.loading("\u6B63\u5728\u66F4\u65B0"),u.prev=1,u.next=4,Y({id:i||""},{bookName:t.bookName||"",bookAuthor:t.bookAuthor||"",bookPrice:t.bookPrice||"",bookTypeId:t.bookTypeId||"",bookDesc:t.bookDesc||"",isBorrowed:t.isBorrowed||"",bookImg:t.bookImg||""});case 4:if(h=u.sent,n(),h.code!==2e4){u.next=10;break}return u.abrupt("return",!0);case 10:return u.abrupt("return",!1);case 11:u.next=17;break;case 13:return u.prev=13,u.t0=u.catch(1),n(),u.abrupt("return",!1);case 17:case"end":return u.stop()}},e,null,[[1,13]])}));return function(i,t){return c.apply(this,arguments)}}(),Ue=function(){var c=l()(a()().mark(function e(i){var t,n,h,d=arguments;return a()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(t=d.length>1&&d[1]!==void 0?d[1]:3,n=A.ZP.loading("\u6B63\u5728\u5220\u9664"),i){g.next=4;break}return g.abrupt("return",!0);case 4:return g.prev=4,g.next=7,Z({ids:i.map(function(N){return N.id}).filter(function(N){return N!=null}).join(",")});case 7:return h=g.sent,n(),g.abrupt("return",!0);case 12:return g.prev=12,g.t0=g.catch(4),n(),g.abrupt("return",!1);case 16:case"end":return g.stop()}},e,null,[[4,12]])}));return function(i){return c.apply(this,arguments)}}(),Ve=function(){var e=(0,C.useModel)("@@initialState"),i=e.initialState,t=(0,H.Z)(i),n=t.canSeeAdmin,h=(0,E.useState)(!1),d=v()(h,2),u=d[0],g=d[1],N=(0,E.useState)(!1),se=v()(N,2),oe=se[0],q=se[1],ce=(0,E.useState)(!1),z=v()(ce,2),j=z[0],ee=z[1],pe=(0,E.useState)(!1),G=v()(pe,2),$e=G[0],me=G[1],Ke=(0,E.useState)({}),Se=v()(Ke,2),le=Se[0],ie=Se[1],_=(0,E.useRef)(),Ne=(0,E.useState)(),Pe=v()(Ne,2),U=Pe[0],fe=Pe[1],ze=(0,E.useState)([]),Ce=v()(ze,2),te=Ce[0],Te=Ce[1],Ge=(0,E.useState)([]),ke=v()(Ge,2),ve=ke[0],_e=ke[1],Je=(0,E.useState)([]),Fe=v()(Je,2),je=Fe[0],Qe=Fe[1],Ye=function(){var m=l()(a()().mark(function p(){var s;return a()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,K();case 2:s=k.sent,_e(s.data);case 4:case"end":return k.stop()}},p)}));return function(){return m.apply(this,arguments)}}();(0,E.useEffect)(function(){Ye()},[]),(0,E.useEffect)(function(){if(ve.length>0){var m=ve.reduce(function(p,s){return p[s.id]={text:s.typeName},p},{});Qe(m)}ie({options:je})},[ve]);var He=[{title:"\u786E\u8BA4\u8FD8\u4E66\u65F6\u95F4",dataIndex:"returnTime",valueType:"dateTime",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"\u5FC5\u9009\u9879"}]}}],he=[{title:"id",dataIndex:"id",valueType:"text",hideInForm:!0},{title:"\u56FE\u4E66\u540D",dataIndex:"bookName",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u4F5C\u8005",dataIndex:"bookAuthor",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u4EF7\u683C",dataIndex:"bookPrice",valueType:"money",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u56FE\u4E66\u7C7B\u578B",dataIndex:"bookTypeId",valueEnum:je,formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u63CF\u8FF0",dataIndex:"bookDesc",valueType:"text",hideInSearch:!0},{title:"\u662F\u5426\u88AB\u501F\u9605",dataIndex:"isBorrowed",valueEnum:{true:{text:"\u662F"},false:{text:"\u5426"}}},{title:"\u56FE\u4E66\u56FE\u7247",dataIndex:"tableBookImg",valueType:"image",hideInSearch:!0,hideInForm:!0},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",render:function(p,s){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(O.Z,{canSeeRole:"Admin",children:(0,o.jsx)("a",{onClick:function(){me(!0),ie(s)},children:"\u4FEE\u6539"})}),(0,o.jsx)("a",{onClick:function(){fe(s),ee(!0)},style:{marginLeft:8},children:"\u67E5\u770B"}),(0,o.jsx)(O.Z,{canSeeRole:"Reader",children:(0,o.jsx)("a",{style:{marginLeft:8},onClick:function(){q(!0),fe(s)},children:"\u501F\u9605"})})]})}}];return(0,o.jsxs)(X._z,{header:{title:"\u7528\u6237\u7BA1\u7406"},children:[(0,o.jsx)(L.Z,{pagination:{pageSize:10,showQuickJumper:!0},headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:_,rowKey:"id",search:{labelWidth:120},toolBarRender:function(){return[(0,o.jsx)(O.Z,{canSeeRole:"Admin",children:(0,o.jsx)(ne.ZP,{type:"primary",onClick:function(){return g(!0)},children:"\u65B0\u589E"},"1")})]},request:function(){var m=l()(a()().mark(function p(s,P,k){var f,re,Ie;return a()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,J({pageNum:s.current,pageSize:s.pageSize,id:s.id,bookName:s.bookName,bookAuthor:s.bookAuthor,bookTypeId:s.bookTypeId,isBorrowed:s.isBorrowed});case 2:return f=ae.sent,re=f.data,Ie=f.success,ae.abrupt("return",{data:(re==null?void 0:re.list)||[],total:(re==null?void 0:re.total)||5,success:Ie});case 6:case"end":return ae.stop()}},p)}));return function(p,s,P){return m.apply(this,arguments)}}(),columns:he,rowSelection:n?{onChange:function(p,s){return Te(s)},getCheckboxProps:function(p){return{disabled:!n}}}:void 0}),(te==null?void 0:te.length)>0&&(0,o.jsx)(T.S,{extra:(0,o.jsxs)("div",{children:["\u5DF2\u9009\u62E9"," ",(0,o.jsx)("a",{style:{fontWeight:600},children:te.length})," ","\u9879\xA0\xA0"]}),children:(0,o.jsx)(ne.ZP,{type:"primary",onClick:l()(a()().mark(function m(){var p,s;return a()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,Ue(te);case 2:Te([]),(p=_.current)===null||p===void 0||(s=p.reloadAndRest)===null||s===void 0||s.call(p);case 4:case"end":return k.stop()}},m)})),children:"\u6279\u91CF\u5220\u9664"})}),(0,o.jsx)(ye,{onCancel:function(){return g(!1)},modalVisible:u,children:(0,o.jsx)(L.Z,{onSubmit:function(){var m=l()(a()().mark(function p(s){var P;return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.log(s,"value"),f.next=3,xe(s);case 3:P=f.sent,P&&(g(!1),_.current&&_.current.reload());case 5:case"end":return f.stop()}},p)}));return function(p){return m.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:he})}),(0,o.jsx)(ye,{title:"\u501F\u9605\u786E\u8BA4",onCancel:function(){return q(!1)},modalVisible:oe,children:(0,o.jsx)(L.Z,{onSubmit:function(){var m=l()(a()().mark(function p(s){var P;return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.log(s,"value11"),console.log(U,"row11"),f.next=4,Oe(U.id,s.returnTime);case 4:P=f.sent,console.log(P,"response"),P&&(q(!1),_.current&&_.current.reload());case 7:case"end":return f.stop()}},p)}));return function(p){return m.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:He})}),le&&Object.keys(le).length?(0,o.jsx)(Ze,{onSubmit:function(){var m=l()(a()().mark(function p(s){var P;return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Le(le.id,s);case 2:P=f.sent,P&&(me(!1),ie({}),_.current&&_.current.reload());case 4:case"end":return f.stop()}},p)}));return function(p){return m.apply(this,arguments)}}(),onCancel:function(){me(!1),ie({})},updateModalVisible:$e,values:le}):null,(0,o.jsx)(Be.Z,{width:600,open:j,onClose:function(){ee(!1),fe(void 0)},closable:!1,children:(U==null?void 0:U.id)&&(0,o.jsx)(w.vY,{column:2,title:"\u56FE\u4E66\u7C7B\u578B\u8BE6\u60C5",request:l()(a()().mark(function m(){return a()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",{data:U||{}});case 1:case"end":return s.stop()}},m)})),params:{id:U==null?void 0:U.id},columns:he})})]})},We=Ve}}]);
