"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[127],{48803:function(se,I,a){var A=a(26118),b=a(28992);I.Z=function(Z){var t=Z.children,M=Z.canSeeRole,g=(0,A.useModel)("@@initialState"),N=g.initialState,v=(0,b.Z)(N),w=v.canSeeAdmin,B=v.canSeeReader;return M==="Admin"?w?t:null:M==="Reader"?B?t:null:M===void 0&&(w||B)?t:null}},8805:function(se,I,a){a.r(I),a.d(I,{default:function(){return je}});var A=a(48305),b=a.n(A),Z=a(90228),t=a.n(Z),M=a(26068),g=a.n(M),N=a(87999),v=a.n(N),w=a(26118);function B(o,e){return $.apply(this,arguments)}function $(){return $=v()(t()().mark(function o(e,u){return t()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,w.request)("/borrow/getList",g()({method:"GET",params:g()({},e)},u||{})));case 1:case"end":return r.stop()}},o)})),$.apply(this,arguments)}function le(o,e){return k.apply(this,arguments)}function k(){return k=v()(t()().mark(function o(e,u){return t()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,w.request)("/borrow/add",g()({method:"POST",headers:{"Content-Type":"application/json"},data:e},u||{})));case 1:case"end":return r.stop()}},o)})),k.apply(this,arguments)}function ie(o,e,u){return D.apply(this,arguments)}function D(){return D=v()(t()().mark(function o(e,u,n){var r;return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.id,s.abrupt("return",(0,w.request)("/borrow/update/".concat(r),g()({method:"PUT",headers:{"Content-Type":"application/json"},params:g()({},e),data:u},n||{})));case 2:case"end":return s.stop()}},o)})),D.apply(this,arguments)}function oe(o,e){return V.apply(this,arguments)}function V(){return V=v()(t()().mark(function o(e,u){var n;return t()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=e.ids,p.abrupt("return",(0,w.request)("/borrow/delete/".concat(n),g()({method:"DELETE",params:g()({},e)},u||{})));case 2:case"end":return p.stop()}},o)})),V.apply(this,arguments)}var de=a(28992),z=a(48803),ce=a(99505),W=a(93378),me=a(22421),fe=a(7389),L=a(48049),H=a(73694),ve=a(34830),T=a(75271),K=a(86073),l=a(52676),he=function(e){var u=e.modalVisible,n=e.onCancel;return(0,l.jsx)(K.Z,{destroyOnClose:!0,title:"\u65B0\u589E",width:420,open:u,onCancel:function(){return n()},footer:null,children:e.children})},pe=he,G=a(51560),J=a(42410),Q=a(85557),ge=a(11333),X=a.n(ge),Ie=function(e,u){for(var n=[],r=e;r<u;r++)n.push(r);return n},Se=function(e){return(0,l.jsx)(G.L0,{stepsProps:{size:"small"},stepsFormRender:function(n,r){return(0,l.jsx)(K.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:"\u4FEE\u6539",open:e.updateModalVisible,footer:r,onCancel:function(){return e.onCancel()},children:n})},onFinish:e.onSubmit,children:(0,l.jsxs)(G.L0.StepForm,{initialValues:{userName:e.values.userName,bookName:e.values.bookName,borrowTime:e.values.borrowTime,returnTime:e.values.returnTime},title:"\u4FEE\u6539\u501F\u9605\u4FE1\u606F",children:[(0,l.jsx)(J.Z,{width:"md",name:"userName",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}]}),(0,l.jsx)(J.Z,{width:"md",name:"bookName",label:"\u4E66\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}]}),(0,l.jsx)(Q.Z,{name:"borrowTime",label:"\u501F\u4E66\u65F6\u95F4",transform:function(n){return{borrowTime:n?X()(n).format("YYYY-MM-DD HH:mm:ss"):null}}}),(0,l.jsx)(Q.Z,{name:"returnTime",label:"\u8FD8\u4E66\u65F6\u95F4",transform:function(n){return{returnTime:n?X()(n).format("YYYY-MM-DD HH:mm:ss"):null}}})]})})},be=Se,we=function(){var o=v()(t()().mark(function e(u){var n,r;return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=L.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),s.prev=1,s.next=4,le(g()({},u));case 4:if(r=s.sent,n(),r.code!==2e4){s.next=10;break}return s.abrupt("return",!0);case 10:return s.abrupt("return",!1);case 11:s.next=17;break;case 13:return s.prev=13,s.t0=s.catch(1),n(),s.abrupt("return",!1);case 17:case"end":return s.stop()}},e,null,[[1,13]])}));return function(u){return o.apply(this,arguments)}}(),ye=function(){var o=v()(t()().mark(function e(u,n){var r,p;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return r=L.ZP.loading("\u6B63\u5728\u66F4\u65B0"),c.prev=1,c.next=4,ie({id:u||""},{userName:n.userName||"",bookName:n.bookName||"",borrowTime:n.borrowTime||"",returnTime:n.returnTime||""});case 4:if(p=c.sent,r(),p.code!==2e4){c.next=10;break}return c.abrupt("return",!0);case 10:return c.abrupt("return",!1);case 11:c.next=17;break;case 13:return c.prev=13,c.t0=c.catch(1),r(),c.abrupt("return",!1);case 17:case"end":return c.stop()}},e,null,[[1,13]])}));return function(u,n){return o.apply(this,arguments)}}(),Te=function(){var o=v()(t()().mark(function e(u){var n,r,p,s=arguments;return t()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(n=s.length>1&&s[1]!==void 0?s[1]:3,r=L.ZP.loading("\u6B63\u5728\u5220\u9664"),u){m.next=4;break}return m.abrupt("return",!0);case 4:return m.prev=4,m.next=7,oe({ids:u.map(function(R){return R.id}).filter(function(R){return R!=null}).join(",")});case 7:return p=m.sent,r(),m.abrupt("return",!0);case 12:return m.prev=12,m.t0=m.catch(4),r(),m.abrupt("return",!1);case 16:case"end":return m.stop()}},e,null,[[4,12]])}));return function(u){return o.apply(this,arguments)}}(),Ce=function(){var e=(0,w.useModel)("@@initialState"),u=e.initialState,n=(0,de.Z)(u),r=n.canSeeAdmin,p=(0,T.useState)(!1),s=b()(p,2),c=s[0],m=s[1],R=(0,T.useState)(!1),q=b()(R,2),Ze=q[0],Be=q[1],Re=(0,T.useState)(!1),_=b()(Re,2),Fe=_[0],U=_[1],Ee=(0,T.useState)({}),ee=b()(Ee,2),P=ee[0],Y=ee[1],F=(0,T.useRef)(),Me=(0,T.useState)(),re=b()(Me,2),y=re[0],ne=re[1],xe=(0,T.useState)([]),ae=b()(xe,2),x=ae[0],te=ae[1],O=[{title:"id",dataIndex:"id",valueType:"text",hideInForm:!0},{title:"\u7528\u6237\u540D",dataIndex:"userName",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u4E66\u540D",dataIndex:"bookName",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u5FC5\u586B\u9879"}]}},{title:"\u501F\u4E66\u65F6\u95F4",dataIndex:"borrowTime",valueType:"dateTime",hideInSearch:!0},{title:"\u8FD8\u4E66\u65F6\u95F4",dataIndex:"returnTime",valueType:"dateTime",hideInSearch:!0},{title:"\u501F\u4E66\u65F6\u95F4\u8303\u56F4",dataIndex:"borrowRange",valueType:"dateRange",hideInTable:!0,hideInForm:!0},{title:"\u8FD8\u4E66\u65F6\u95F4\u8303\u56F4",dataIndex:"returnRange",valueType:"dateRange",hideInTable:!0,hideInForm:!0},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",render:function(d,i){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(z.Z,{canSeeRole:"Admin",children:(0,l.jsx)("a",{onClick:function(){U(!0),Y(i)},children:"\u4FEE\u6539"})}),(0,l.jsx)("a",{onClick:function(){return ne(i)},style:{marginLeft:8},children:"\u67E5\u770B"})]})}}];return(0,l.jsxs)(ce._z,{header:{title:"\u7528\u6237\u7BA1\u7406"},children:[(0,l.jsx)(W.Z,{pagination:{pageSize:10,showQuickJumper:!0},headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:F,rowKey:"id",search:{labelWidth:120},toolBarRender:function(){return[(0,l.jsx)(z.Z,{canSeeRole:"Admin",children:(0,l.jsx)(H.ZP,{type:"primary",onClick:function(){return m(!0)},children:"\u65B0\u589E"},"1")})]},request:function(){var f=v()(t()().mark(function d(i,S,C){var h,j,ue;return t()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,B({pageNum:i.current,pageSize:i.pageSize,id:i.id,userName:i.userName,bookName:i.bookName,borrowRange:i.borrowRange,returnRange:i.returnRange});case 2:return h=E.sent,j=h.data,ue=h.success,E.abrupt("return",{data:(j==null?void 0:j.list)||[],total:(j==null?void 0:j.total)||5,success:ue});case 6:case"end":return E.stop()}},d)}));return function(d,i,S){return f.apply(this,arguments)}}(),columns:O,rowSelection:r?{onChange:function(d,i){return te(i)},getCheckboxProps:function(d){return{disabled:!r}}}:void 0}),(x==null?void 0:x.length)>0&&(0,l.jsx)(me.S,{extra:(0,l.jsxs)("div",{children:["\u5DF2\u9009\u62E9"," ",(0,l.jsx)("a",{style:{fontWeight:600},children:x.length})," ","\u9879\xA0\xA0"]}),children:(0,l.jsx)(H.ZP,{type:"primary",onClick:v()(t()().mark(function f(){var d,i;return t()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,Te(x);case 2:te([]),(d=F.current)===null||d===void 0||(i=d.reloadAndRest)===null||i===void 0||i.call(d);case 4:case"end":return C.stop()}},f)})),children:"\u6279\u91CF\u5220\u9664"})}),(0,l.jsx)(pe,{onCancel:function(){return m(!1)},modalVisible:c,children:(0,l.jsx)(W.Z,{onSubmit:function(){var f=v()(t()().mark(function d(i){var S;return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,we(i);case 2:S=h.sent,S&&(m(!1),F.current&&F.current.reload());case 4:case"end":return h.stop()}},d)}));return function(d){return f.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:O})}),P&&Object.keys(P).length?(0,l.jsx)(be,{onSubmit:function(){var f=v()(t()().mark(function d(i){var S;return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,ye(P.id,i);case 2:S=h.sent,S&&(U(!1),Y({}),F.current&&F.current.reload());case 4:case"end":return h.stop()}},d)}));return function(d){return f.apply(this,arguments)}}(),onCancel:function(){U(!1),Y({})},updateModalVisible:Fe,values:P}):null,(0,l.jsx)(ve.Z,{width:600,open:!!y,onClose:function(){ne(void 0)},closable:!1,children:(y==null?void 0:y.id)&&(0,l.jsx)(fe.vY,{column:2,title:"\u56FE\u4E66\u7C7B\u578B\u8BE6\u60C5",request:v()(t()().mark(function f(){return t()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",{data:y||{}});case 1:case"end":return i.stop()}},f)})),params:{id:y==null?void 0:y.id},columns:O})})]})},je=Ce}}]);
